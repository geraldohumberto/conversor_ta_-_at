<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Conversor de Mídia Interativo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .tab {
            display: none;
        }
        .tab.active {
            display: block;
        }
        textarea, input {
            width: 100%;
            margin: 10px 0;
        }
        button {
            margin: 10px 5px;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Conversor de Mídia Interativo</h1>
    
    <div>
        <button onclick="showTab('tts')">Texto para Áudio</button>
        <button onclick="showTab('stt')">Áudio para Texto</button>
    </div>

    <div id="tts-tab" class="tab active">
        <h2>Texto para Áudio</h2>
        
        <textarea id="texto-input" rows="10" placeholder="Digite o texto para converter"></textarea>
        
        <button onclick="converterTextoParaAudio()">Converter para Áudio (Google TTS)</button>
        
        <div>
            <audio id="audio-player" controls style="display:none; width:100%;"></audio>
            <button id="download-audio" style="display:none;" onclick="downloadAudio()">Baixar Áudio</button>
        </div>
    </div>

    <div id="stt-tab" class="tab">
        <h2>Áudio para Texto</h2>
        
        <input type="file" id="audio-input" accept="audio/*">
        
        <button onclick="converterAudioParaTexto()">Transcrever Áudio</button>
        
        <textarea id="texto-resultado" rows="10" readonly placeholder="Texto transcrito aparecerá aqui"></textarea>
    </div>

    <script>
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        async function converterTextoParaAudio() {
            const texto = document.getElementById('texto-input').value.trim();
            const audioPlayer = document.getElementById('audio-player');
            const downloadButton = document.getElementById('download-audio');
            
            if (!texto) {
                alert('Por favor, digite um texto para converter.');
                return;
            }

            try {
                // Divide o texto em partes para contornar limitações
                const partesTexto = dividirTexto(texto);
                const audioUrls = await Promise.all(partesTexto.map(criarUrlAudio));

                // Concatena os blobs de áudio
                const audioBlobs = await Promise.all(audioUrls.map(async (url) => {
                    const response = await fetch(url);
                    return await response.blob();
                }));

                const audioBlob = new Blob(audioBlobs, { type: 'audio/mp3' });
                const audioUrl = URL.createObjectURL(audioBlob);

                // Configura o player de áudio
                audioPlayer.src = audioUrl;
                audioPlayer.style.display = 'block';
                downloadButton.style.display = 'block';

                // Tenta reproduzir
                try {
                    await audioPlayer.play();
                } catch (playError) {
                    console.warn('Reprodução automática bloqueada:', playError);
                }

            } catch (error) {
                console.error('Erro na conversão de texto para áudio:', error);
                alert('Não foi possível converter o texto para áudio. Verifique sua conexão.');
            }
        }

        function dividirTexto(texto, tamanhoParte = 200) {
            const partes = [];
            let parteAtual = '';

            const palavras = texto.split(/\s+/);
            palavras.forEach(palavra => {
                if ((parteAtual + ' ' + palavra).length > tamanhoParte) {
                    partes.push(parteAtual.trim());
                    parteAtual = palavra;
                } else {
                    parteAtual += ' ' + palavra;
                }
            });

            if (parteAtual) partes.push(parteAtual.trim());

            return partes;
        }

        function criarUrlAudio(texto) {
            return `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl=pt-BR&q=${encodeURIComponent(texto)}`;
        }

        function downloadAudio() {
            const audioPlayer = document.getElementById('audio-player');
            const texto = document.getElementById('texto-input').value.trim();
            
            if (audioPlayer.src) {
                const link = document.createElement('a');
                link.href = audioPlayer.src;
                link.download = `audio_${texto.substring(0, 20)}.mp3`;
                link.click();
            }
        }

        function converterAudioParaTexto() {
            const audioInput = document.getElementById('audio-input');
            const textoResultado = document.getElementById('texto-resultado');
            
            if (audioInput.files.length === 0) {
                alert('Por favor, selecione um arquivo de áudio.');
                return;
            }

            const arquivo = audioInput.files[0];
            const leitor = new FileReader();
            
            leitor.onload = (e) => {
                // Simulação de transcrição
                textoResultado.value = `Transcrição simulada do arquivo: ${arquivo.name}\n\nNa versão completa, usaríamos um serviço de conversão de áudio para texto.`;
            };
            
            leitor.readAsDataURL(arquivo);
        }
    </script>
</body>
</html>
